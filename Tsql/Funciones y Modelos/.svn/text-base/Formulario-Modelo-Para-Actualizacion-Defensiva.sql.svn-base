
use B_MIGRACIONES2010
go
IF OBJECT_ID ('#bancocambio', 'U') IS NOT NULL
    DROP TABLE #bancocambio;

DECLARE @MyTableVar table(
    SALDOVIEJO NUMERIC(18,2),
	SALDONUEVO NUMERIC(18,2),
    CUENTAVIEJA VARCHAR(20),
    CUENTANUEVA VARCHAR(20) 
);

CREATE TABLE #bancocambio
( 
    SALDOVIEJO NUMERIC(18,2),
	SALDONUEVO NUMERIC(18,2),
    CUENTAVIEJA VARCHAR(20),
    CUENTANUEVA VARCHAR(20) 
 );

--UPDATE  OD
SET OD.SALDO_ACTUAL=NEW.SALDO
   OUTPUT 
        DELETED.SALDO_ACTUAL AS SALDOVIEJO,
        INSERTED.SALDO_ACTUAL AS SALDOONUEVO,
        DELETED.CUENTA AS CUENTAVIEJA,
        INSERTED.CUENTA AS CUENTANUEVA
INTO @MyTableVar
FROM DBO.M_MIGRACIONES5 AS OD
INNER JOIN DBO.SALDOSBC AS NEW
ON NEW.CUENTA=OD.CUENTA
where NEW.saldo <> OD.saldo_actual

INSERT #bancocambio SELECT E.SALDOVIEJO,E.SALDONUEVO,E.CUENTAVIEJA,E.CUENTANUEVA FROM @MyTableVar AS E 
GO
SELECT * FROM #bancocambio
GO

